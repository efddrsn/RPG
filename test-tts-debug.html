<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug TTS - Delphos AI</title>
    <style>
        body {
            font-family: 'Share Tech Mono', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
        }
        button:hover {
            background: #00cc00;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .log {
            background: #111;
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 20px 0;
            height: 300px;
            overflow-y: scroll;
            font-size: 14px;
        }
        .error {
            color: #ff0000;
        }
        .success {
            color: #00ff00;
        }
        .warning {
            color: #ffff00;
        }
        .info {
            color: #00ffff;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
        }
        select, input {
            background: #222;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 5px;
            margin: 5px;
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Debug do Sistema TTS - Delphos AI</h1>
        
        <div class="test-section">
            <h2>Status do Sistema</h2>
            <div id="status"></div>
        </div>

        <div class="test-section">
            <h2>Testes de Voz</h2>
            <button id="test-basic">Teste Básico</button>
            <button id="test-voices">Listar Vozes</button>
            <button id="test-portuguese">Teste Português</button>
            <button id="test-demonic">Teste Voz Demoníaca</button>
            <button id="test-long">Teste Texto Longo</button>
            <button id="stop-speech">Parar Fala</button>
        </div>

        <div class="test-section">
            <h2>Configurações</h2>
            <label>Voz: <select id="voice-select"></select></label>
            <label>Velocidade: <input type="range" id="rate" min="0.5" max="2" value="1" step="0.1"></label>
            <label>Tom: <input type="range" id="pitch" min="0" max="2" value="1" step="0.1"></label>
            <label>Volume: <input type="range" id="volume" min="0" max="1" value="1" step="0.1"></label>
        </div>

        <div class="test-section">
            <h2>Texto Customizado</h2>
            <textarea id="custom-text" style="width: 100%; background: #222; color: #00ff00; border: 1px solid #00ff00; padding: 10px;">Digite aqui o texto para testar...</textarea>
            <br>
            <button id="test-custom">Testar Texto Customizado</button>
        </div>

        <div class="log" id="log"></div>
    </div>

    <script src="voice-system.js"></script>
    <script>
        // Sistema de log
        const logDiv = document.getElementById('log');
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Verificar suporte do navegador
        function checkBrowserSupport() {
            const status = document.getElementById('status');
            let html = '<h3>Suporte do Navegador:</h3>';
            
            // Speech Synthesis
            if ('speechSynthesis' in window) {
                html += '<p class="success">✅ Speech Synthesis API disponível</p>';
                log('Speech Synthesis API está disponível', 'success');
            } else {
                html += '<p class="error">❌ Speech Synthesis API não disponível</p>';
                log('Speech Synthesis API NÃO está disponível!', 'error');
            }
            
            // Web Speech API
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                html += '<p class="success">✅ Speech Recognition API disponível</p>';
                log('Speech Recognition API está disponível', 'success');
            } else {
                html += '<p class="warning">⚠️ Speech Recognition API não disponível</p>';
                log('Speech Recognition API não está disponível', 'warning');
            }
            
            // Navegador
            const userAgent = navigator.userAgent;
            html += `<p>Navegador: ${userAgent}</p>`;
            log(`User Agent: ${userAgent}`, 'info');
            
            status.innerHTML = html;
        }

        // Inicializar sistema de voz
        let voiceSystem = null;
        try {
            voiceSystem = new DelphosVoiceSystem();
            log('Sistema de voz Delphos inicializado com sucesso', 'success');
        } catch (error) {
            log(`Erro ao inicializar sistema de voz: ${error.message}`, 'error');
        }

        // Listar vozes disponíveis
        function listVoices() {
            const voices = speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voice-select');
            voiceSelect.innerHTML = '';
            
            log(`Total de vozes disponíveis: ${voices.length}`, 'info');
            
            voices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${voice.name} (${voice.lang})`;
                voiceSelect.appendChild(option);
                
                // Log vozes em português
                if (voice.lang.includes('pt')) {
                    log(`Voz PT encontrada: ${voice.name} (${voice.lang})`, 'success');
                }
            });
            
            if (voices.length === 0) {
                log('AVISO: Nenhuma voz foi carregada ainda. Tente novamente em alguns segundos.', 'warning');
            }
        }

        // Função de teste básico
        function testBasicTTS() {
            log('Iniciando teste básico de TTS...', 'info');
            
            try {
                const utterance = new SpeechSynthesisUtterance('Teste básico do sistema de síntese de voz.');
                utterance.lang = 'pt-BR';
                
                utterance.onstart = () => log('TTS iniciado', 'success');
                utterance.onend = () => log('TTS finalizado', 'success');
                utterance.onerror = (event) => log(`Erro no TTS: ${event.error}`, 'error');
                
                speechSynthesis.speak(utterance);
            } catch (error) {
                log(`Erro ao executar TTS: ${error.message}`, 'error');
            }
        }

        // Teste com texto em português
        function testPortuguese() {
            log('Testando TTS em português...', 'info');
            
            if (voiceSystem) {
                voiceSystem.speak('Olá! Eu sou a Delphos AI. Este é um teste do sistema de síntese de voz em português brasileiro.')
                    .then(() => log('Teste português concluído', 'success'))
                    .catch(error => log(`Erro no teste português: ${error}`, 'error'));
            } else {
                log('Sistema de voz não está inicializado', 'error');
            }
        }

        // Teste voz demoníaca
        function testDemonicVoice() {
            log('Testando voz demoníaca...', 'info');
            
            if (voiceSystem) {
                voiceSystem.speak('As profundezas digitais aguardam... O conhecimento proibido será revelado...', true)
                    .then(() => log('Teste de voz demoníaca concluído', 'success'))
                    .catch(error => log(`Erro no teste demoníaco: ${error}`, 'error'));
            } else {
                log('Sistema de voz não está inicializado', 'error');
            }
        }

        // Teste com texto longo
        function testLongText() {
            log('Testando texto longo...', 'info');
            
            const longText = `Análise completa iniciada. Os padrões oceânicos indicam anomalias significativas nas coordenadas especificadas. 
            A convergência dos dados sugere que eventos de magnitude considerável estão prestes a ocorrer. 
            Recomendo cautela ao interpretar estas informações. O sistema detectou flutuações incomuns nos algoritmos de previsão.`;
            
            if (voiceSystem) {
                voiceSystem.speak(longText)
                    .then(() => log('Teste de texto longo concluído', 'success'))
                    .catch(error => log(`Erro no teste longo: ${error}`, 'error'));
            }
        }

        // Teste com texto customizado
        function testCustomText() {
            const text = document.getElementById('custom-text').value;
            const voiceIndex = document.getElementById('voice-select').value;
            const rate = document.getElementById('rate').value;
            const pitch = document.getElementById('pitch').value;
            const volume = document.getElementById('volume').value;
            
            log(`Testando texto customizado: "${text.substring(0, 50)}..."`, 'info');
            
            try {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                utterance.rate = parseFloat(rate);
                utterance.pitch = parseFloat(pitch);
                utterance.volume = parseFloat(volume);
                
                const voices = speechSynthesis.getVoices();
                if (voices[voiceIndex]) {
                    utterance.voice = voices[voiceIndex];
                }
                
                utterance.onstart = () => log('TTS customizado iniciado', 'success');
                utterance.onend = () => log('TTS customizado finalizado', 'success');
                utterance.onerror = (event) => log(`Erro no TTS customizado: ${event.error}`, 'error');
                
                speechSynthesis.speak(utterance);
            } catch (error) {
                log(`Erro ao executar TTS customizado: ${error.message}`, 'error');
            }
        }

        // Parar síntese
        function stopSpeech() {
            log('Parando síntese de voz...', 'info');
            speechSynthesis.cancel();
            if (voiceSystem) {
                voiceSystem.stopSpeaking();
            }
            log('Síntese de voz parada', 'success');
        }

        // Event listeners
        document.getElementById('test-basic').addEventListener('click', testBasicTTS);
        document.getElementById('test-voices').addEventListener('click', listVoices);
        document.getElementById('test-portuguese').addEventListener('click', testPortuguese);
        document.getElementById('test-demonic').addEventListener('click', testDemonicVoice);
        document.getElementById('test-long').addEventListener('click', testLongText);
        document.getElementById('test-custom').addEventListener('click', testCustomText);
        document.getElementById('stop-speech').addEventListener('click', stopSpeech);

        // Inicialização
        window.addEventListener('load', () => {
            checkBrowserSupport();
            
            // Tentar carregar vozes após um delay
            setTimeout(() => {
                listVoices();
                
                // Se não houver vozes, tentar novamente
                if (speechSynthesis.getVoices().length === 0) {
                    log('Tentando carregar vozes novamente...', 'warning');
                    speechSynthesis.addEventListener('voiceschanged', listVoices);
                }
            }, 100);
        });

        // Debug: expor objetos globais
        window.debugTTS = {
            voiceSystem,
            speechSynthesis: window.speechSynthesis,
            getVoices: () => speechSynthesis.getVoices(),
            testSimple: () => {
                const u = new SpeechSynthesisUtterance('Teste simples');
                speechSynthesis.speak(u);
            }
        };
        
        log('Sistema de debug carregado. Use window.debugTTS no console para acessar funções de debug.', 'info');
    </script>
</body>
</html>