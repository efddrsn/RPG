<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Sistema de Voz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .debug-panel {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #4CAF50;
        }
        .status.error {
            background: #f44336;
        }
        .status.warning {
            background: #ff9800;
        }
    </style>
</head>
<body>
    <h1>Debug Sistema de Voz Delphos</h1>
    
    <div class="debug-panel">
        <h2>Status do Sistema</h2>
        <div id="system-status"></div>
    </div>
    
    <div class="debug-panel">
        <h2>Testes de Voz</h2>
        <button id="test-init">1. Inicializar Sistema</button>
        <button id="test-voices" disabled>2. Listar Vozes</button>
        <button id="test-speak-normal" disabled>3. Testar Voz Normal</button>
        <button id="test-speak-demonic" disabled>4. Testar Voz Demoníaca</button>
        <button id="test-listen" disabled>5. Testar Microfone</button>
        <button id="clear-log">Limpar Log</button>
    </div>
    
    <div class="debug-panel">
        <h2>Console de Debug</h2>
        <div id="debug-log" class="log"></div>
    </div>
    
    <script src="voice-system.js"></script>
    <script>
        let voiceSystem = null;
        const log = document.getElementById('debug-log');
        const systemStatus = document.getElementById('system-status');
        
        // Função para adicionar log
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44' : type === 'warning' ? '#fa0' : '#0f0';
            log.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
            console.log(`[Debug] ${message}`);
        }
        
        // Função para atualizar status
        function updateStatus() {
            if (!voiceSystem) {
                systemStatus.innerHTML = '<div class="status error">Sistema não inicializado</div>';
                return;
            }
            
            const status = `
                <div class="status ${voiceSystem.speechSynthesis ? 'success' : 'error'}">
                    Speech Synthesis: ${voiceSystem.speechSynthesis ? '✓ Disponível' : '✗ Não disponível'}
                </div>
                <div class="status ${voiceSystem.speechRecognition ? 'success' : 'error'}">
                    Speech Recognition: ${voiceSystem.speechRecognition ? '✓ Disponível' : '✗ Não disponível'}
                </div>
                <div class="status ${voiceSystem.voicesLoaded ? 'success' : 'warning'}">
                    Vozes carregadas: ${voiceSystem.voicesLoaded ? '✓ Sim' : '⚠ Não'}
                </div>
                <div class="status ${voiceSystem.voices.normal ? 'success' : 'warning'}">
                    Voz normal: ${voiceSystem.voices.normal ? voiceSystem.voices.normal.name : 'Não definida'}
                </div>
                <div class="status ${voiceSystem.voices.demonic ? 'success' : 'warning'}">
                    Voz demoníaca: ${voiceSystem.voices.demonic ? voiceSystem.voices.demonic.name : 'Não definida'}
                </div>
            `;
            systemStatus.innerHTML = status;
        }
        
        // Interceptar console.log original
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            originalLog(...args);
            addLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError(...args);
            addLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn(...args);
            addLog(args.join(' '), 'warning');
        };
        
        // Teste 1: Inicializar
        document.getElementById('test-init').addEventListener('click', async () => {
            addLog('Iniciando sistema de voz...');
            try {
                voiceSystem = new DelphosVoiceSystem();
                addLog('Sistema criado com sucesso');
                
                // Aguardar vozes carregarem
                setTimeout(() => {
                    updateStatus();
                    document.getElementById('test-voices').disabled = false;
                    document.getElementById('test-speak-normal').disabled = false;
                    document.getElementById('test-speak-demonic').disabled = false;
                    document.getElementById('test-listen').disabled = false;
                }, 1000);
                
            } catch (error) {
                addLog(`Erro ao inicializar: ${error.message}`, 'error');
            }
        });
        
        // Teste 2: Listar vozes
        document.getElementById('test-voices').addEventListener('click', () => {
            addLog('Listando vozes disponíveis...');
            const voices = speechSynthesis.getVoices();
            addLog(`Total de vozes: ${voices.length}`);
            
            voices.forEach((voice, index) => {
                addLog(`${index}: ${voice.name} (${voice.lang}) ${voice.default ? '[DEFAULT]' : ''}`);
            });
        });
        
        // Teste 3: Voz normal
        document.getElementById('test-speak-normal').addEventListener('click', async () => {
            addLog('Testando voz normal...');
            const text = 'Olá! Eu sou a Delphos AI. Este é um teste da minha voz normal.';
            
            try {
                await voiceSystem.speak(text, false);
                addLog('Fala concluída');
            } catch (error) {
                addLog(`Erro ao falar: ${error.message}`, 'error');
            }
        });
        
        // Teste 4: Voz demoníaca
        document.getElementById('test-speak-demonic').addEventListener('click', async () => {
            addLog('Testando voz demoníaca...');
            const text = 'As profundezas digitais me chamam... A convergência se aproxima...';
            
            try {
                await voiceSystem.speak(text, true);
                addLog('Fala concluída');
            } catch (error) {
                addLog(`Erro ao falar: ${error.message}`, 'error');
            }
        });
        
        // Teste 5: Microfone
        document.getElementById('test-listen').addEventListener('click', () => {
            addLog('Testando microfone...');
            
            // Configurar callback temporário
            const originalHandler = voiceSystem.handleVoiceInput;
            voiceSystem.handleVoiceInput = (transcript) => {
                addLog(`Você disse: "${transcript}"`);
                voiceSystem.handleVoiceInput = originalHandler;
            };
            
            try {
                voiceSystem.startListening();
                addLog('Fale algo...');
            } catch (error) {
                addLog(`Erro ao iniciar microfone: ${error.message}`, 'error');
            }
        });
        
        // Limpar log
        document.getElementById('clear-log').addEventListener('click', () => {
            log.innerHTML = '';
            addLog('Log limpo');
        });
        
        // Verificar se APIs estão disponíveis
        window.addEventListener('load', () => {
            addLog('Página carregada');
            addLog(`Speech Synthesis API: ${window.speechSynthesis ? 'Disponível' : 'Não disponível'}`);
            addLog(`Speech Recognition API: ${window.SpeechRecognition || window.webkitSpeechRecognition ? 'Disponível' : 'Não disponível'}`);
            
            // Verificar vozes após delay
            setTimeout(() => {
                const voices = speechSynthesis.getVoices();
                addLog(`Vozes disponíveis no carregamento: ${voices.length}`);
            }, 500);
        });
    </script>
</body>
</html>